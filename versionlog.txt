BEAM PATH OPTIMIZER - VERSION LOG
================================================================================

Version 1.3 (2025-12-03)
--------------------------------------------------------------------------------
Bug Fixes:

  • Fixed Critical Background Rendering Bug
    - Background now properly fills entire workspace area
    - Previous: Background only rendered in center portion due to coordinate system mismatch
    - Fixed: Adjusted drawBackground() to use centered world coordinates (-width/2 to +width/2)
    - Issue was visible when using solid colors or background images

New Features:

  • Wavelength Management Modal
    - Replaced browser prompts with full-featured modal interface
    - Button now displays "Manage Wavelengths" text instead of gear icon
    - Add, edit, and delete custom wavelengths with visual color picker
    - List view shows all wavelengths with color swatches
    - Preset wavelengths cannot be deleted (protected)
    - HTML5 color picker for easy color selection (no hex codes needed)

  • Background Image Opacity Control
    - New opacity slider (0-100%) in Settings modal
    - Applies transparency to background images
    - Saved in state and persists across sessions
    - 0% = completely transparent, 100% = fully opaque

  • Grid Settings Relocated
    - Moved from left panel to floating button in top-right corner of canvas
    - Click grid icon (⚞) to open modal dialog
    - Cleaner left panel with more space for tools
    - Grid settings: enable/disable snap, adjust size (1-50mm)
    - Settings persist and sync with state

  • Default Background Reset Button
    - New "Reset to Default" button in Settings modal
    - Quickly revert to default dark background (#0d1117)
    - Clears any selected image or custom color
    - One-click restoration of original appearance

UI/UX Improvements:

  • Angle Range Limited to 0-180°
    - Input fields and sliders now constrained to 0-180° range
    - Components with angles >180° are normalized for display
    - Prevents confusion with angle wrapping
    - Simplifies angle input for users

  • Properties Pane Restructured (Left-Aligned Layout)
    - Changed from center-aligned to left-aligned with 12px padding
    - Labels on left, values on right for better readability
    - Each property gets its own visual row
    - Position and Size inputs stacked vertically for clarity
    - Example layout:
      ```
      Name:     [textbox]
      Type:     Waveplate
      Position: X [value] mm
                Y [value] mm
      ```

  • Left Panel Items Centered
    - All items in left panel sections now properly centered
    - Tool buttons, component palette, and controls aligned
    - More polished and professional appearance

  • Category Headers Emphasized
    - Section headers ("Navigation", "Beams", "Zones") are now bigger and bolder
    - Font size increased: 11px → 13px
    - Font weight increased: 600 → 700
    - Makes navigation hierarchy immediately obvious

Technical Changes:

  • Version bumped to 1.3
  • Background state extended with opacity property
  • Grid section removed from left panel HTML
  • New modal components: wavelength-modal, grid-modal
  • CSS updates for left-alignment, centering, and new modals
  • Floating button component added for canvas overlay UI
  • Wavelength CRUD operations: add, edit, delete with validation
  • Coordinate system fix in Renderer.drawBackground()


Version 1.2 (2025-12-03)
--------------------------------------------------------------------------------
New Features:

  • Multiple Wavelengths / Beam Colors
    - Select wavelength before adding beams (Beams section in left panel)
    - 6 preset wavelengths: 633nm HeNe, 532nm Nd:YAG, 1064nm IR, 405nm Violet, 780nm GaAs, 850nm VCSEL
    - Add custom wavelengths via gear button
    - Segments can have multiple colors (displayed as divided line segments)
    - Multi-color segments support for co-aligned beams

  • Workspace Background Settings
    - Settings button (gear icon) in toolbar
    - Choose solid color with color picker
    - Or select image file for background
    - Image path saved in JSON (falls back to color if not found)

  • Global Grid Settings
    - New "Grid" section in left panel
    - Toggle grid snapping on/off globally
    - Adjustable grid size slider (1mm - 50mm)
    - Updates visual grid and snap behavior

UI/UX Improvements:

  • Keyboard Shortcut: R Key Rotation
    - Press R to rotate selected component(s) 90° clockwise
    - Respects "Fixed Angle" setting - shows warning if angle is fixed
    - Works with multiple selection

  • Right Panel Improvements
    - All items centered for cleaner appearance
    - Draggable divider to resize panel width (180-400px)
    - Text size slider (80-150%) at top of panel
    - Settings persist in localStorage

  • Left Panel Restructured
    - "Tools" renamed to "Navigation" (Select, Pan)
    - New "Beams" section for beam tools and wavelength selection
    - Components, Zones, and Grid sections below

Technical:
  • Version bumped to 1.2
  • State extended with grid, background, and wavelengths
  • BeamSegment model supports wavelengthIds array
  • Multi-color segment rendering in Renderer


Version 1.1 (2025-12-02)
--------------------------------------------------------------------------------
UI/UX Improvements:
  • Added drag-and-drop for components from palette to canvas
    - Click and drag components from the left panel directly onto the canvas
    - Visual preview follows cursor while dragging
    - Green border and coordinate indicator when over canvas
    - Shows grid-snapped position where component will be placed
    - Makes grid snapping immediately apparent to users

  • Fixed component proportions in palette
    - Waveplate and Filter icons now display as thin rectangles (matching mirrors)
    - Previously displayed as squares which was misleading
    - All palette icons now accurately represent their actual component shapes

  • Updated default component sizes for accuracy
    - Waveplate: changed from 20×20mm (square) to 20×5mm (rectangle)
    - Filter: changed from 20×20mm (square) to 20×5mm (rectangle)
    - Beam splitters and detectors remain square as physically accurate
    - Mirrors, lenses, and waveplates/filters now display as rectangles

User Experience:
  • Component buttons now show grab cursor (hand) to indicate draggability
  • Removed confusing two-click placement workflow
  • Keyboard shortcuts still work for quick component placement


Version 1.0 (Initial Release)
--------------------------------------------------------------------------------
Core Features:
  • HTML5 Canvas-based optical table designer
  • 7 component types: Source, Mirror, Beam Splitter, Lens, Waveplate, Filter, Detector
  • Interactive beam path visualization with color coding
  • Pan (shift+drag/middle mouse) and zoom (scroll wheel)
  • Grid background with 25mm snap

Component Management:
  • Click-to-place components (deprecated in v1.1)
  • Drag to reposition components
  • Component property editing panel
  • Multi-select with Ctrl+click or drag selection box
  • Fixed position/angle locks for optimization

Beam Path System:
  • "Add Beams" tool for connecting components
  • Automatic beam physics (reflection, transmission)
  • Beam splitters create reflected and transmitted paths
  • Color coding by branch level (red → orange → yellow → green)
  • Line thickness represents beam power
  • Direction arrows on segments
  • Segment selection and deletion

Constraints & Zones:
  • Keep-out zones (areas where components cannot be placed)
  • Mounting zone (target area for center of mass)
  • Per-component mount zones with X/Y padding and offset
  • Visual feedback for constraint violations

Center of Mass Tracking:
  • Real-time CoM calculation weighted by component mass
  • Crosshair display on canvas
  • Status bar shows if CoM is inside mounting zone

Optimization (Simulated Annealing):
  • Adaptive parameters based on component count
  • Cost function: CoM distance, footprint, path length, violations
  • Constrained moves preserve relative beam angles
  • Fixed angle mode for components
  • Beam collision detection and penalties
  • Progress tracking: iteration count, improvement %, violations
  • Pause/Resume/Accept/Revert workflow

Results View Mode:
  • Cost vs iteration graph with interactive selection
  • Hover to see iteration details
  • Click/double-click to preview any iteration's layout
  • Split-screen comparison mode (original vs selected)
  • Apply any iteration, not just the best
  • Snapshot storage every 10 iterations

File Management:
  • Save to JSON (full state serialization)
  • Load from JSON with version checking
  • Migration prompts for older file formats
  • Unsaved changes warnings

Undo/Redo:
  • Full history stack for all state changes
  • Ctrl+Z / Ctrl+Y keyboard shortcuts

Beam Physics:
  • Default angles: 0° for transmission optics, 45° for mirrors
  • Source emission direction control
  • Shallow angle mode for beam splitters
  • Movement constraints to prevent breaking beam angles
  • Automatic angle snapping to valid values

Keyboard Shortcuts:
  • V: Select tool
  • H: Pan tool
  • C: Connect beam tool
  • M: Place mirror
  • S: Place source (Ctrl+S saves)
  • Delete/Backspace: Delete selected
  • Escape: Clear selection
  • Ctrl+Z: Undo
  • Ctrl+Y: Redo
  • +/-: Zoom in/out

Status Bar:
  • Center of Mass position
  • Mount zone status (OK/OUTSIDE/Not defined)
  • Violation count
  • Component count
  • Zoom level
  • Cursor position in workspace coordinates

Version Tracking:
  • Version badge displayed in top left toolbar
  • File format versioning for compatibility
  • Version comparison utilities for migration detection
